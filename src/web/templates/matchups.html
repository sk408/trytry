{% extends "base.html" %}
{% block content %}
<h1 class="page-title">Matchups</h1>

<div class="card">
  <h2>Analyze Matchup</h2>
  <form method="get" action="/matchups">
    <div class="form-row">
      <div class="form-group">
        <label for="home">Home Team</label>
        <select name="home_team_id" id="home">
          {% for t in teams %}
          <option value="{{ t.id }}" {% if home_team_id == t.id %}selected{% endif %}>
            {{ t.abbr }} - {{ t.name }}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="away">Away Team</label>
        <select name="away_team_id" id="away">
          {% for t in teams %}
          <option value="{{ t.id }}" {% if away_team_id == t.id %}selected{% endif %}>
            {{ t.abbr }} - {{ t.name }}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>
    <button type="submit">Analyze</button>
  </form>

  {% if prediction %}
  <div class="prediction-result mt-4">
    <div class="prediction-matchup">
      {% for t in teams if t.id == away_team_id %}{{ t.abbr }}{% endfor %}
      <span class="text-muted">@</span>
      {% for t in teams if t.id == home_team_id %}{{ t.abbr }}{% endfor %}
    </div>
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-value">{{ "%.1f"|format(prediction.predicted_spread) }}</div>
        <div class="stat-label">Spread (Home)</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{{ "%.1f"|format(prediction.predicted_total) }}</div>
        <div class="stat-label">Total</div>
      </div>
    </div>
    <p class="text-muted text-center">Based on current rosters and recent stats</p>
  </div>
  {% elif error %}
  <div class="error-box mt-4">{{ error }}</div>
  {% endif %}
</div>

<div class="card">
  <h2>Upcoming Games</h2>
  <p class="text-muted">Tap a game to analyze</p>
  {% if games %}
  <div class="games-list">
    {% for g in games[:50] %}
    <a href="/matchups?home_team_id={{ g.home_team_id }}&away_team_id={{ g.away_team_id }}" 
       class="game-row {% if home_team_id == g.home_team_id and away_team_id == g.away_team_id %}active{% endif %}">
      <span class="game-date">{{ g.game_date }}</span>
      <span class="game-teams">
        <span class="away">{{ g.away_abbr }}</span>
        <span class="at">@</span>
        <span class="home">{{ g.home_abbr }}</span>
      </span>
    </a>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <p>No upcoming games</p>
    <p class="text-muted">Run sync from Dashboard</p>
  </div>
  {% endif %}
</div>
{% endblock %}
