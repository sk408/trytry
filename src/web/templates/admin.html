{% extends "base.html" %}
{% set active = "admin" %}
{% block title %}Admin â€” NBA Predictor{% endblock %}

{% block content %}
<h1 class="section-header">Admin</h1>

<div class="card mb-4">
    <div class="card-header">Database</div>
    <div class="grid-2">
        <div>
            <p class="text-sm text-secondary">Path</p>
            <p class="font-mono text-sm">{{ db_path }}</p>
        </div>
        <div>
            <p class="text-sm text-secondary">Size</p>
            <p class="font-bold">{{ '%.2f'|format(db_size / 1024 / 1024) }} MB</p>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">Weights</div>
    <div class="btn-group">
        <button class="btn btn-outline" onclick="viewWeights()">View Current Weights</button>
        <button class="btn btn-danger" onclick="clearWeights()">Clear All Weights</button>
    </div>
    <pre id="weightsOutput" class="log-output mt-3 hidden" style="white-space: pre-wrap;"></pre>
</div>

<div class="card">
    <div class="card-header">Danger Zone</div>
    <form action="/admin/reset" method="post" 
          onsubmit="return confirm('This will DELETE all data. Are you sure?')">
        <button type="submit" class="btn btn-danger">Delete & Reinitialize Database</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
async function viewWeights() {
    const el = document.getElementById('weightsOutput');
    el.classList.remove('hidden');
    try {
        const r = await fetch('/api/weights');
        const data = await r.json();
        el.textContent = JSON.stringify(data, null, 2);
    } catch(e) {
        el.textContent = 'Error loading weights';
    }
}

async function clearWeights() {
    if (!confirm('Clear all global and per-team weights?')) return;
    await fetch('/api/weights/clear', {method: 'POST'});
    alert('Weights cleared');
}
</script>
{% endblock %}
